package com.gasmonitor.service.security;import com.gasmonitor.dao.TenantRepository;import com.gasmonitor.dao.UserRepository;import com.gasmonitor.entity.Tenant;import com.gasmonitor.entity.User;import org.slf4j.Logger;import org.slf4j.LoggerFactory;import org.springframework.beans.factory.annotation.Autowired;import org.springframework.security.core.GrantedAuthority;import org.springframework.security.core.authority.SimpleGrantedAuthority;import org.springframework.security.core.userdetails.UserDetails;import org.springframework.security.core.userdetails.UserDetailsService;import org.springframework.security.core.userdetails.UsernameNotFoundException;import org.springframework.stereotype.Service;import org.springframework.util.StringUtils;import java.util.ArrayList;import java.util.List;// * Created by saplmm on 2017/6/10.@Servicepublic class CustomUserDetailsService implements UserDetailsService {    private Logger log = LoggerFactory.getLogger(CustomUserDetailsService.class);    @Autowired    UserRepository userRepository;    @Autowired    TenantRepository tenantRepository;    @Override    public UserDetails loadUserByUsername(String s) throws UsernameNotFoundException {        //目前使用Tenant        return loadTenantByName(s);    }    public UserDetails loadTenantByName(String s) throws UsernameNotFoundException {        log.info("loadUserByUsername({})", s);        Tenant user = tenantRepository.findByName(s);        //如果user==null 直接返回空        if (user == null) {            return null;        }        //检查是否有权限        if (StringUtils.isEmpty(user.getRole())) {            throw new UsernameNotFoundException("没有权限");        }        log.info("loadUserByUsername({})-->password:{}-->role:{}-->user:{}", s, user.getPassword(), user.getRole(), user);        //管理玩家的权限        List<GrantedAuthority> authorities = new ArrayList<GrantedAuthority>();        authorities.add(new SimpleGrantedAuthority(user.getRole()));        return new org.springframework.security.core.userdetails.User(user.getName(), user.getPassword(), authorities);    }    public UserDetails loadUserByName(String s) throws UsernameNotFoundException {        log.info("loadUserByUsername({})", s);        User user = userRepository.findByUsername(s);        log.info("loadUserByUsername({})-->user:{}", s, user);        List<GrantedAuthority> authorities = new ArrayList<GrantedAuthority>();        authorities.add(new SimpleGrantedAuthority(user.getRole()));        return new org.springframework.security.core.userdetails.User(user.getUsername(), user.getPassword(), authorities);    }}